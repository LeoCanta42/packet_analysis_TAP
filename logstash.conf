# Example packet
# {"index":{"_index":"packets-2024-06-19","_type":"doc"}}
# {"timestamp":"1718819567871","layers":{"frame_raw":"a4c3f0996e61e48d8c6d6bd008004500009e796f00007911f3be08080808c0a803690035c6d6008a4a934afe818000010003000000010764656661756c74076578702d74617303636f6d0000010001c00c0005000100000cd4002812646561756c742d6578702d7461732d636f6d06652d3030313408652d6d7365646765036e657400c03100050001000000240002c044c044000100010000002400040d6b055d0000290200000000000000","frame":{"frame_frame_interface_id":"0","frame_frame_interface_name":"wlp2s0","frame_frame_encap_type":"1","frame_frame_time":"2024-06-19T17:52:47.871967020Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1718819567.871967020","frame_frame_time_delta":"0.000000000","frame_frame_time_delta_displayed":"0.000000000","frame_frame_time_relative":"0.000000000","frame_frame_number":"1","frame_frame_len":"172","frame_frame_cap_len":"172","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"eth:ethertype:ip:udp:dns"},"eth_raw":"a4c3f0996e61e48d8c6d6bd00800","eth":{"eth_eth_dst_raw":"a4c3f0996e61","eth_eth_dst":"a4:c3:f0:99:6e:61","eth_eth_dst_resolved_raw":"a4c3f0996e61","eth_eth_dst_resolved":"a4:c3:f0:99:6e:61","eth_eth_dst_oui_raw":"a4c3f0","eth_eth_dst_oui":"10798064","eth_eth_dst_oui_resolved_raw":"a4c3f0996e61","eth_eth_dst_oui_resolved":"Intel Corporate","eth_eth_addr_raw":"a4c3f0996e61","eth_eth_addr":"a4:c3:f0:99:6e:61","eth_eth_addr_resolved_raw":"a4c3f0996e61","eth_eth_addr_resolved":"a4:c3:f0:99:6e:61","eth_eth_addr_oui_raw":"a4c3f0","eth_eth_addr_oui":"10798064","eth_eth_addr_oui_resolved_raw":"a4c3f0996e61","eth_eth_addr_oui_resolved":"Intel Corporate","eth_eth_dst_lg_raw":"0","eth_eth_dst_lg":false,"eth_eth_lg_raw":"0","eth_eth_lg":false,"eth_eth_dst_ig_raw":"0","eth_eth_dst_ig":false,"eth_eth_ig_raw":"0","eth_eth_ig":false,"eth_eth_src_raw":"e48d8c6d6bd0","eth_eth_src":"e4:8d:8c:6d:6b:d0","eth_eth_src_resolved_raw":"e48d8c6d6bd0","eth_eth_src_resolved":"e4:8d:8c:6d:6b:d0","eth_eth_src_oui_raw":"e48d8c","eth_eth_src_oui":"14978444","eth_eth_src_oui_resolved_raw":"e48d8c6d6bd0","eth_eth_src_oui_resolved":"Routerboard.com","eth_eth_addr_raw":"e48d8c6d6bd0","eth_eth_addr":"e4:8d:8c:6d:6b:d0","eth_eth_addr_resolved_raw":"e48d8c6d6bd0","eth_eth_addr_resolved":"e4:8d:8c:6d:6b:d0","eth_eth_addr_oui_raw":"e48d8c","eth_eth_addr_oui":"14978444","eth_eth_addr_oui_resolved_raw":"e48d8c6d6bd0","eth_eth_addr_oui_resolved":"Routerboard.com","eth_eth_src_lg_raw":"0","eth_eth_src_lg":false,"eth_eth_lg_raw":"0","eth_eth_lg":false,"eth_eth_src_ig_raw":"0","eth_eth_src_ig":false,"eth_eth_ig_raw":"0","eth_eth_ig":false,"eth_eth_type_raw":"0800","eth_eth_type":"0x0800"},"ip_raw":"4500009e796f00007911f3be08080808c0a80369","ip":{"ip_ip_version_raw":"45","ip_ip_version":"4","ip_ip_hdr_len_raw":"45","ip_ip_hdr_len":"20","ip_ip_dsfield_raw":"00","ip_ip_dsfield":"0x00","ip_ip_dsfield_dscp_raw":"0","ip_ip_dsfield_dscp":"0","ip_ip_dsfield_ecn_raw":"0","ip_ip_dsfield_ecn":"0","ip_ip_len_raw":"009e","ip_ip_len":"158","ip_ip_id_raw":"796f","ip_ip_id":"0x796f","ip_ip_flags_raw":"00","ip_ip_flags":"0x00","ip_ip_flags_rb_raw":"0","ip_ip_flags_rb":false,"ip_ip_flags_df_raw":"0","ip_ip_flags_df":false,"ip_ip_flags_mf_raw":"0","ip_ip_flags_mf":false,"ip_ip_frag_offset_raw":"0","ip_ip_frag_offset":"0","ip_ip_ttl_raw":"79","ip_ip_ttl":"121","ip_ip_proto_raw":"11","ip_ip_proto":"17","ip_ip_checksum_raw":"f3be","ip_ip_checksum":"0xf3be","ip_ip_checksum_status":"2","ip_ip_src_raw":"08080808","ip_ip_src":"8.8.8.8","ip_ip_addr_raw":["08080808","c0a80369"],"ip_ip_addr":["8.8.8.8","192.168.3.105"],"ip_ip_src_host_raw":"08080808","ip_ip_src_host":"8.8.8.8","ip_ip_host_raw":["08080808","c0a80369"],"ip_ip_host":["8.8.8.8","192.168.3.105"],"ip_ip_dst_raw":"c0a80369","ip_ip_dst":"192.168.3.105","ip_ip_dst_host_raw":"c0a80369","ip_ip_dst_host":"192.168.3.105"},"udp_raw":"0035c6d6008a4a93","udp":{"udp_udp_srcport_raw":"0035","udp_udp_srcport":"53","udp_udp_dstport_raw":"c6d6","udp_udp_dstport":"50902","udp_udp_port_raw":["0035","c6d6"],"udp_udp_port":["53","50902"],"udp_udp_length_raw":"008a","udp_udp_length":"138","udp_udp_checksum_raw":"4a93","udp_udp_checksum":"0x4a93","udp_udp_checksum_status":"2","udp_udp_stream":"0","text":"Timestamps","udp_udp_time_relative":"0.000000000","udp_udp_time_delta":"0.000000000","udp_udp_payload_raw":"4afe818000010003000000010764656661756c74076578702d74617303636f6d0000010001c00c0005000100000cd4002812646561756c742d6578702d7461732d636f6d06652d3030313408652d6d7365646765036e657400c03100050001000000240002c044c044000100010000002400040d6b055d0000290200000000000000","udp_udp_payload":"4a:fe:81:80:00:01:00:03:00:00:00:01:07:64:65:66:61:75:6c:74:07:65:78:70:2d:74:61:73:03:63:6f:6d:00:00:01:00:01:c0:0c:00:05:00:01:00:00:0c:d4:00:28:12:64:65:61:75:6c:74:2d:65:78:70:2d:74:61:73:2d:63:6f:6d:06:65:2d:30:30:31:34:08:65:2d:6d:73:65:64:67:65:03:6e:65:74:00:c0:31:00:05:00:01:00:00:00:24:00:02:c0:44:c0:44:00:01:00:01:00:00:00:24:00:04:0d:6b:05:5d:00:00:29:02:00:00:00:00:00:00:00"},"dns_raw":"4afe818000010003000000010764656661756c74076578702d74617303636f6d0000010001c00c0005000100000cd4002812646561756c742d6578702d7461732d636f6d06652d3030313408652d6d7365646765036e657400c03100050001000000240002c044c044000100010000002400040d6b055d0000290200000000000000","dns":{"dns_dns_id_raw":"4afe","dns_dns_id":"0x4afe","dns_dns_flags_raw":"8180","dns_dns_flags":"0x8180","dns_dns_flags_response_raw":"1","dns_dns_flags_response":true,"dns_dns_flags_opcode_raw":"0","dns_dns_flags_opcode":"0","dns_dns_flags_authoritative_raw":"0","dns_dns_flags_authoritative":false,"dns_dns_flags_truncated_raw":"0","dns_dns_flags_truncated":false,"dns_dns_flags_recdesired_raw":"1","dns_dns_flags_recdesired":true,"dns_dns_flags_recavail_raw":"1","dns_dns_flags_recavail":true,"dns_dns_flags_z_raw":"0","dns_dns_flags_z":false,"dns_dns_flags_authenticated_raw":"0","dns_dns_flags_authenticated":false,"dns_dns_flags_checkdisable_raw":"0","dns_dns_flags_checkdisable":false,"dns_dns_flags_rcode_raw":"0","dns_dns_flags_rcode":"0","dns_dns_count_queries_raw":"0001","dns_dns_count_queries":"1","dns_dns_count_answers_raw":"0003","dns_dns_count_answers":"3","dns_dns_count_auth_rr_raw":"0000","dns_dns_count_auth_rr":"0","dns_dns_count_add_rr_raw":"0001","dns_dns_count_add_rr":"1","text":["Queries","Answers","Additional records"],"text":["default.exp-tas.com: type A, class IN","default.exp-tas.com: type CNAME, class IN, cname deault-exp-tas-com.e-0014.e-msedge.net","deault-exp-tas-com.e-0014.e-msedge.net: type CNAME, class IN, cname e-0014.e-msedge.net","e-0014.e-msedge.net: type A, class IN, addr 13.107.5.93","<Root>: type OPT"],"dns_dns_qry_name_raw":"0764656661756c74076578702d74617303636f6d00","dns_dns_qry_name":"default.exp-tas.com","dns_dns_qry_name_len_raw":"0764656661756c74076578702d74617303636f6d00","dns_dns_qry_name_len":"19","dns_dns_count_labels_raw":"0764656661756c74076578702d74617303636f6d00","dns_dns_count_labels":"3","dns_dns_qry_type_raw":"0001","dns_dns_qry_type":"1","dns_dns_qry_class_raw":"0001","dns_dns_qry_class":"0x0001","dns_dns_resp_name_raw":["c00c","c031","c044","00"],"dns_dns_resp_name":["default.exp-tas.com","deault-exp-tas-com.e-0014.e-msedge.net","e-0014.e-msedge.net","<Root>"],"dns_dns_resp_type_raw":["0005","0005","0001","0029"],"dns_dns_resp_type":["5","5","1","41"],"dns_dns_resp_class_raw":["0001","0001","0001"],"dns_dns_resp_class":["0x0001","0x0001","0x0001"],"dns_dns_resp_ttl_raw":["00000cd4","00000024","00000024"],"dns_dns_resp_ttl":["3284","36","36"],"dns_dns_resp_len_raw":["0028","0002","0004","0000"],"dns_dns_resp_len":["40","2","4","0"],"dns_dns_cname_raw":["12646561756c742d6578702d7461732d636f6d06652d3030313408652d6d7365646765036e657400","c044"],"dns_dns_cname":["deault-exp-tas-com.e-0014.e-msedge.net","e-0014.e-msedge.net"],"dns_dns_a_raw":"0d6b055d","dns_dns_a":"13.107.5.93","dns_dns_rr_udp_payload_size_raw":"0200","dns_dns_rr_udp_payload_size":"512","dns_dns_resp_ext_rcode_raw":"00","dns_dns_resp_ext_rcode":"0x00","dns_dns_resp_edns0_version_raw":"00","dns_dns_resp_edns0_version":"0","dns_dns_resp_z_raw":"0000","dns_dns_resp_z":"0x0000","dns_dns_resp_z_do_raw":"0","dns_dns_resp_z_do":false,"dns_dns_resp_z_reserved_raw":"0","dns_dns_resp_z_reserved":"0x0000","dns_dns_unsolicited":true}}}

input {
  file {
    path => "/usr/share/logstash/packets.log"
    sincedb_path => "/dev/null"
    codec => "json"
    start_position => "end"
    # stat_interval => 0.01   # Check the file for changes every 0.01 seconds
  }
}

filter {
    # Drop index lines
    if [index] {
      drop {}
    }
    # Removing useless fields
    mutate {
        remove_field => ["event"]
        remove_field => ["host"]
        remove_field => ["log"]
    }
    json {
        source => "message"
    }
}

output {
    # stdout { codec => rubydebug }
    kafka {
        topic_id => packets
        bootstrap_servers => "PLAINTEXT://kafkaserver:9092"
        codec => json
    }
}